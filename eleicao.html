<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema de Contagem de Votos</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        line-height: 1.6;
        background-color: #f5f5f5;
      }
      .container {
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #2c3e50;
        text-align: center;
        border-bottom: 3px solid #3498db;
        padding-bottom: 10px;
      }
      .instrucoes {
        background-color: #2c3e50;
        text-align: center;
        border-bottom: 3px solid #3498db;
        padding-bottom: 10px;
      }
      .resultado {
        background-color: #e8f8f5;
        padding: 15px;
        border-radius: 5px;
        border-left: 4px solid #27ae60;
        margin: 20px 0;
        white-space: pre-line;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Sistema de Contagem de Votos</h1>
      <div class="instrucoes">
        <h3>Instru√ß√µes:</h3>
        <p><strong>Como usar:</strong></p>
        <ul>
          <li>Digite um n√∫mero para votar em um candidato</li>
          <li>Digite <strong>0</strong> para voto em branco</li>
          <li>Digite <strong>-1</strong> para voto nulo</li>
          <li>Digite <strong>999</strong> para finalizar a contagem</li>
        </ul>
        <p>
          <em
            >Abra o console do navegador (F12) para ver detalhes adicionais</em
          >
        </p>
      </div>
      <div id="resultado" class="resultado" style="display: none"></div>
    </div>
  </body>
  <script>
    let totalEleitores = 0;
    let valorTotais = 0;
    let branco = 0;
    let nulo = 0;
    let validos = 0;
    let candidatos = [];

    function iniVotacao() {
      valorTotais = 0;
      branco = 0;
      nulo = 0;
      validos = 0;
      candidatos = [];
    }

    function numtotalEleitores() {
      while (true) {
        const input = prompt(
          "Digite o n√∫mero total de eleitores cadastrados no munic√≠pio: "
        );

        if (input == null) {
          return null;
        }

        const total = parseInt(input);
        if (isNaN(total)) {
          alert("Por favor, digite um n√∫mero v√°lido!");
          continue;
        }
        if (total <= 0) {
          alert("O n√∫mero de eleitores deve ser maior que zero!");
          continue;
        }
      }
    }

    function adcCandidato(numCadidato) {
      for (let i = 0; i < candidatos.length; i++) {
        if (candidatos[i].numero === numCadidato) {
          candidatos[i].votos++;
          return;
        }
      }
      // Se n√£o existe, cria novo candidato
      candidatos.push({
        numero: numCadidato,
        votos: 1,
      });
    }

    function processarVoto(voto) {
      const votoStr = voto.toString().trim();

      if (votoStr === "999") {
        return "finalizar";
      } else if (votoStr === "0") {
        branco++;
        valorTotais++;
        console.log("‚úÖVoto em branco registrado");
        return "branco";
      } else if (votoStr === "-1") {
        nulo++;
        valorTotais++;
        console.log("‚úÖVoto nulo registrado");
        return "nulo";
      } else {
        const numCadidato = parseInt(votoStr);

        if (isNaN(numCadidato) || numCadidato <= 0) {
          return "invalido";
        }

        adcCandidato(numCadidato);
        validos++;
        valorTotais++;
        console.log(`‚úÖVoto no candidato ${numCadidato} registrado`);
        return "cadidato";
      }
    }

    function calcularPercentuias() {
      const percBranco = (branco / numtotalEleitores) * 100;
      const percNulo = (nulo / numtotalEleitores) * 100;
      const percValido = (validos / numtotalEleitores) * 100;
      const percAbstencao =
        ((numtotalEleitores - valorTotais) / numtotalEleitores) * 100;
      const percComparecimentos = (valorTotais / numtotalEleitores) * 100;

      return {
        percBranco,
        percNulo,
        percValido,
        percAbstencao,
        percComparecimentos,
      };
    }

    function ordenarCandidatos() {
      candidatos.sort((a, b) => b.votos - a.votos);
    }

    function gerarRelatorio() {
      const percentuais = calcularPercentuias();
      ordenarCandidatos();

      let relatorio = `üìä RELAT√ìRIO FINAL DA ELEI√á√ÉO \n`;
      relatorio += `-------------------------------------------`;

      relatorio += `üìà RESUMO GERAL: \n`;
      relatorio += `- Total de eleitores: ${totalEleitores.toLocaleString()}\n`;
      relatorio += `- Votos registrados: ${valorTotais.toLocaleString()}\n`;
      relatorio += `- Absten√ß√µes? ${
        totalEleitores - valorTotais.toLocaleString()
      }\n`;
      relatorio += `- Comparecimento: ${percentuais.percComparecimentos.toFixed(
        2
      )}\n\n`;

      relatorio += `üó≥Ô∏è DISTRIBUI√á√ÉO DOS VOTOS:\n`;
      relatorio += `- Votos v√°lidos: ${validos.toLocaleString()} (${percentuias.percValido.toFixed(
        2
      )})\n`;
      relatorio += `- Votos em branco: ${branco.toLocaleString()} (${percentuias.percBranco.toFixed(
        2
      )})\n`;
      relatorio += `- Votos nulos: ${nulo.toLocaleString()} (${percentuias.percNulo.toFixed(
        2
      )})\n`;
      relatorio += `- Absten√ß√µes: ${(
        totalEleitores - valorTotais
      ).toLocaleString()} (${percentuias.percAbstencao.toFixed(2)})\n`;

      if (candidatos.length > 0) {
        relatorio += `üèÜ RESULTADO POR CANDIDATO:\n`;
        candidatos.forEach((candidato, index) => {
          const percCandidato = (candidato.votos / totalEleitores) * 100;
          const percValidosCandidato =
            validos > 0 ? (candidato.voto / validos) * 100 : 0;

          relatorio += `${index + 1}¬∫ - Candidato ${candidato.numero}: `;
          relatorio += `${candidato.votos.toLocaleString()} votos`;
          relatorio += `(${percCandidato.toFixed(2)}% dos eleitores, `;
          relatorio += `${percValidosCandidato.toFixed(2)}% dos v√°lidos)\n`;
        });
      }
      relatorio += `\n‚úÖ VERIFICA√á√ÉO:\n`;
      const totalVerificacao = validos + branco + nulo;
      if (totalVerificacao === valorTotais) {
        relatorio == `‚úì Contagem conferida - todos os votos contabilizados \n`;
      } else {
        relatorio += `Total: ${totalVerificacao} = ${validos} + ${branco} + ${nulo}`;
      }
      relatorio += `Total: ${totalVerificacao} = ${validos} + ${branco} + ${nulo}`;

      return relatorio;
    }

    function mostrarResultado(relatorio) {
      alert(relatorio);

      const divResultado = document.getElementById("resultado");
      divResultado.textContent = relatorio;
      divResultado.style.display = "block";

      // mais detalhes console
      console.log("\n" + relatorio);
      console.table(candidatos);
    }

    function coletarVotos() {
      console.log("üó≥Ô∏è Iniciando coleta de votos...");

      while (true) {
        const voto = prompt(
          ` SISTEMA DE VOTA√á√ÉO \n\n` +
            `Votos registrados at√© agora: ${valorTotais}\n` +
            `- V√°lidos: ${validos} | Brancos: ${branco} | Nulos: ${nulo}\n\n` +
            `Digite seu voto:\n` +
            `- N√∫mero do candidato (ex: 13, 22, 45)\n` +
            `- 0 = Branco | -1 = Nulo | 999 = Finalizar \n`
        );

        if (voto === null) {
          const confirmar = confirm(
            "Deseja realmente sair sem finalizar a contagem?"
          );
          if (confirmar) {
            return false;
          }
          continue;
        }

        const resultado = processarVoto(voto);

        if (resultado === "finalizar") {
          break;
        } else if (resultado === "invalido") {
          alert(
            "‚ùå Voto inv√°lido! Use apenas n√∫meros positivos para candidatos."
          );
        }
      }
      return true;
    }

    function main() {
      console.log(" Iniciando Sistema de Contagem de Votos");

      try {
        iniVotacao();

        totalEleitores = numtotalEleitores();

        if (totalEleitores === null) {
          alert("Opera√ß√£o cancelada pelo usu√°rio.");
          return;
        }

        console.log(
          `üìã Total de eleitores cadastrados: ${totalEleitores.toLocaleString()}`
        );

        const votacaoConcluida = coletarVotos();

        if (!vota√ß√£oConcluida) {
          alert("Vota√ß√£o cancelada!");
          return;
        }

        if (valorTotais === 0) {
          alert(" Nenhum voto foi registrado! ");
          return;
        }

        const relatorio = gerarRelatorio();
        mostrarResultado(relatorio);
      } catch (error) {
        alert(` Erro no sistema: ${error.message}`);
        console.error("Erro:", error);
      }
    }

    function menu() {
      while (true) {
        const opcao = prompt(
          "üó≥Ô∏è SISTEMA DE CONTAGEM DE VOTOS\n\n" +
            "1. Iniciar nova contagem\n" +
            "2. Ver exemplo demonstrativo\n" +
            "3. Sair\n\n" +
            "Escolha uma op√ß√£o (1-3):"
        );

        if (opcao === null || opcao === "3") {
          alert("üëã Obrigado por usar o sistema!");
          return;
        }

        switch (opcao) {
          case "1":
            main();
            break;
          case "2":
            exemplo();
            break;
          default:
            alert("‚ùå Op√ß√£o inv√°lida! Escolha 1, 2 ou 3.");
        }
      }
    }
    window.onload = function () {
      setTimeout(() => {
        menu();
      }, 500);
    };
  </script>
</html>
